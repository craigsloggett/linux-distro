#!/bin/sh -e
#
# Cross Tools - Build linux header files

BUILD_DEST_DIR=/tools  # A place to store compiled binaries.
BUILD_USER=build
BUILD_ROOT_DIR="${STAGE1_ROOT_DIR:-}"

VERSION="5.6.14"
VERSION_MAJOR=`printf '%s\n' "${VERSION}" | cut -c1`

TARGET_TRIPLET="${STAGE1_TARGET:-}"

cd "${BUILD_ROOT_DIR}"/source

# Download from upstream.
wget http://cdn.kernel.org/pub/linux/kernel/v"${VERSION_MAJOR}".x/linux-"${VERSION}".tar.xz
xz -d linux-"${VERSION}".tar.xz
tar -xf linux-"${VERSION}".tar

# Prepare the build folder.
mkdir -v build && cd build
cp -r ../linux-"${VERSION}"/* .

# Compile the source.
make mrproper
make headers_check
make headers

# Install the headers.
cp -r usr/include/* "${BUILD_DEST_DIR}"/include

# Cleanup.
cd ..
rm -rf build

